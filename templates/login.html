{% extends 'base.html' %}
{% block content %}
    <div class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded shadow-md w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Login</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-gray-700 font-medium mb-1">Username</label>
                    <input type="text" id="username" name="username" required
                           class="w-full border border-gray-300 p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label for="password" class="block text-gray-700 font-medium mb-1">Password</label>
                    <input type="password" id="password" name="password" required
                           class="w-full border border-gray-300 p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <button type="submit"
                        class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                    Login
                </button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('login-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const username = btoa(document.getElementById('username').value);
            const password = btoa(document.getElementById('password').value);
            const token = btoa(`${atob(username)}:${atob(password)}`);
            localStorage.setItem('auth_token', token);
            window.location.href = "{% url 'list_services' %}";
        });

        // Override fetch to include Basic Auth if logged in
        const originalFetch = window.fetch;
        window.fetch = function (input, init = {}) {
            const token = localStorage.getItem('auth_token');
            if (token) {
                init.headers = {
                    ...(init.headers || {}),
                    'Authorization': 'Basic ' + token
                };
            }
            return originalFetch(input, init);
        };
    </script>
{% endblock %}
